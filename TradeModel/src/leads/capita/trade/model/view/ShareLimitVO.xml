<?xml version="1.0" encoding="windows-1252" ?>
<!DOCTYPE ViewObject SYSTEM "jbo_03_01.dtd">
<!---->
<ViewObject
  xmlns="http://xmlns.oracle.com/bc4j"
  Name="ShareLimitVO"
  Version="11.1.2.60.81"
  BindingStyle="OracleName"
  CustomQuery="true"
  PageIterMode="Full"
  UseGlueCode="false"
  RangeSize="-1"
  FetchMode="FETCH_ALL"
  FetchSize="20">
  <DesignTime>
    <Attr Name="_isExpertMode" Value="true"/>
  </DesignTime>
  <Properties>
    <SchemaBasedProperties>
      <LABEL
        ResId="leads.capita.trade.model.view.ShareLimitVO_LABEL"/>
    </SchemaBasedProperties>
  </Properties>
  <SQLQuery><![CDATA[SELECT *
  FROM (SELECT investor_accounts.investor_code investor_code
              ,products.product_type
              ,investor_accounts.name          NAME
              ,product_boid.boid               boid
              ,instruments.instrument_name     instrument_name
              ,instruments.short_name          short_name
              ,instruments.instrument_type     instrument_type
              ,instrument_balances.salable_qty salable_qty
              ,trunc(instrument_balances.salable_qty) sale_qty
              ,investor_accounts.business_type business_type
              ,instruments.isin                isin
              ,instruments.instrument_id
              ,trunc(instrument_balances.total_qty)   total_qty
              ,broker_mapping.broker_id        AS broker_id
              ,broker_mapping.trading_code
          FROM investor_accounts
              ,instruments
              ,instrument_balances
              ,product_boid
              ,products
              ,broker_mapping
         WHERE investor_accounts.account_id = instrument_balances.account_id
           AND investor_accounts.account_id = broker_mapping.account_id(+)
           AND instruments.instrument_id = instrument_balances.instrument_id
           AND investor_accounts.productbo_id = product_boid.id
           AND investor_accounts.boid IS NULL
           AND products.product_type <> 'BDA'
           AND investor_accounts.product_id = products.product_id
           AND investor_accounts.business_type = 'MBANK'
           AND instruments.status = 'ACTIVE'
           AND INSTRUMENTS.Instrument_Type NOT IN ('TB')
        UNION
        SELECT investor_accounts.investor_code investor_code
              ,products.product_type
              ,investor_accounts.name          NAME
              ,investor_accounts.boid          boid
              ,instruments.instrument_name     instrument_name
              ,instruments.short_name          short_name
              ,instruments.instrument_type     instrument_type
              ,instrument_balances.salable_qty salable_qty
              ,trunc(instrument_balances.salable_qty) sale_qty
              ,investor_accounts.business_type business_type
              ,instruments.isin                isin
              ,instruments.instrument_id
              ,trunc(instrument_balances.total_qty)   total_qty
              ,broker_mapping.broker_id        AS broker_id
              ,broker_mapping.trading_code
          FROM investor_accounts
              ,instruments
              ,instrument_balances
              ,
               --PRODUCT_BOID,
               products
              ,broker_mapping
         WHERE investor_accounts.account_id = instrument_balances.account_id
           AND investor_accounts.account_id = broker_mapping.account_id(+)
           AND instruments.instrument_id = instrument_balances.instrument_id
           AND investor_accounts.boid IS NOT NULL
           AND products.product_type <> 'BDA'
           AND investor_accounts.product_id = products.product_id
           AND investor_accounts.business_type = 'MBANK'
           AND instruments.status = 'ACTIVE'
           AND INSTRUMENTS.Instrument_Type NOT IN ('TB')
        
        UNION
        
        SELECT investor_accounts.investor_code investor_code
              ,products.product_type
              ,investor_accounts.name          NAME
              ,investor_accounts.boid          boid
              ,instruments.instrument_name     instrument_name
              ,instruments.short_name          short_name
              ,instruments.instrument_type     instrument_type
              ,instrument_balances.salable_qty salable_qty
              ,trunc(instrument_balances.salable_qty) sale_qty
              ,investor_accounts.business_type business_type
              ,instruments.isin                isin
              ,instruments.instrument_id
              ,trunc(instrument_balances.total_qty)   total_qty
              ,NULL                            AS broker_id
              ,investor_accounts.investor_code AS trading_code
          FROM investor_accounts
              ,instruments
              ,instrument_balances
              ,products
         WHERE investor_accounts.account_id = instrument_balances.account_id
           AND instruments.instrument_id = instrument_balances.instrument_id
           AND products.product_type <> 'BDA'
           AND investor_accounts.product_id = products.product_id
           AND investor_accounts.business_type = 'BROKER'
           AND instruments.status = 'ACTIVE'
           AND INSTRUMENTS.Instrument_Type NOT IN ('TB')
        
        UNION ALL
        SELECT ins.trade_code AS investor_code
              ,ins.product_type
              ,ins.product_name AS NAME
              ,ins.boid AS boid
              ,'bda_instrument' AS instrument_name
              ,ins.short_name AS short_name
              ,'bda' AS instrument_type
              ,pkg_investor.get_bda_salable_qty(ins.boid
                                               ,ins.instrument_id, ins.broker_id) AS salable_qty
              ,trunc(pkg_investor.get_bda_salable_qty(ins.boid
                                               ,ins.instrument_id, ins.broker_id)) sale_qty
              ,ins.business_type
              ,ins.isin AS isin
              ,ins.instrument_id
              ,trunc(SUM(ins.total_qty)) AS total_qty
              ,ins.broker_id AS broker_id
              ,ins.trade_code AS trading_code
          FROM (SELECT investor_accounts.investor_code investor_code
                      ,products.product_name
                      ,products.trade_code             trade_code
                      ,products.product_type
                      ,product_boid.boid               boid
                      ,investor_accounts.name          NAME
                      ,investor_accounts.boid          a_boid
                      ,instruments.instrument_name     instrument_name
                      ,instruments.short_name          short_name
                      ,instruments.instrument_type     instrument_type
                      ,instrument_balances.salable_qty salable_qty
                      ,trunc(instrument_balances.salable_qty) sale_qty
                      ,investor_accounts.business_type business_type
                      ,instruments.isin                isin
                      ,instruments.instrument_id
                      ,instrument_balances.total_qty   total_qty
                      ,broker_mapping.broker_id        AS broker_id
                      ,broker_mapping.trading_code
                  FROM investor_accounts
                      ,instruments
                      ,instrument_balances
                      ,products
                      ,product_boid
                      ,broker_mapping
                 WHERE investor_accounts.account_id = instrument_balances.account_id
                   AND investor_accounts.account_id = broker_mapping.account_id(+)
                   AND instruments.instrument_id = instrument_balances.instrument_id
                   AND products.product_type = 'BDA'
                   AND products.product_id = product_boid.product_id
                   AND investor_accounts.product_id = products.product_id
                   AND investor_accounts.business_type = 'MBANK'
                   AND instruments.status = 'ACTIVE'
           AND INSTRUMENTS.Instrument_Type NOT IN ('TB')) ins
         GROUP BY ins.trade_code
                 ,ins.boid
                 ,ins.isin
                 ,ins.short_name
                 ,ins.instrument_id
                 ,ins.product_type
                 ,ins.product_name
                 ,ins.business_type
                 ,ins.broker_id) t
 WHERE t.salable_qty > 0
--WHERE T.PRODUCT_TYPE <> 'OWN'
 ORDER BY t.investor_code
         ,t. product_type]]></SQLQuery>
  <ViewAttribute
    Name="InvestorCode"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="255"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="INVESTOR_CODE"
    Expression="INVESTOR_CODE"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="20"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="InvestorCode_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="ProductType"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="30"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="PRODUCT_TYPE"
    Expression="PRODUCT_TYPE"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="30"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="ProductType_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="Name"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="80"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="NAME"
    Expression="NAME"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="80"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="Name_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="Boid"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="30"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="BOID"
    Expression="BOID"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="30"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="Boid_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="InstrumentName"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="50"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="INSTRUMENT_NAME"
    Expression="INSTRUMENT_NAME"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="50"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="InstrumentName_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="ShortName"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="50"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="SHORT_NAME"
    Expression="SHORT_NAME"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="50"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="ShortName_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="InstrumentType"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="30"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="INSTRUMENT_TYPE"
    Expression="INSTRUMENT_TYPE"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="30"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="InstrumentType_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="SalableQty"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="12"
    Scale="2"
    Type="java.math.BigDecimal"
    ColumnType="NUMBER"
    AliasName="SALABLE_QTY"
    Expression="SALABLE_QTY"
    SQLType="NUMERIC">
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="SalableQty_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="SaleQty"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.math.BigDecimal"
    ColumnType="NUMBER"
    AliasName="SALE_QTY"
    Expression="SALE_QTY"
    SQLType="NUMERIC"/>
  <ViewAttribute
    Name="BusinessType"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="30"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="BUSINESS_TYPE"
    Expression="BUSINESS_TYPE"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="30"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="BusinessType_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="Isin"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="50"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="ISIN"
    Expression="ISIN"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="50"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="Isin_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="InstrumentId"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="6"
    Scale="0"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="INSTRUMENT_ID"
    Expression="INSTRUMENT_ID"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="TotalQty"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="12"
    Scale="2"
    Type="java.math.BigDecimal"
    ColumnType="NUMBER"
    AliasName="TOTAL_QTY"
    Expression="TOTAL_QTY"
    SQLType="NUMERIC">
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="TotalQty_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="BrokerId"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.lang.Integer"
    ColumnType="NUMBER"
    AliasName="BROKER_ID"
    Expression="BROKER_ID"
    SQLType="INTEGER"/>
  <ViewAttribute
    Name="TradingCode"
    IsUpdateable="false"
    IsPersistent="false"
    PrecisionRule="true"
    Precision="15"
    Type="java.lang.String"
    ColumnType="VARCHAR2"
    AliasName="TRADING_CODE"
    Expression="TRADING_CODE"
    SQLType="VARCHAR">
    <DesignTime>
      <Attr Name="_DisplaySize" Value="15"/>
    </DesignTime>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="TradingCode_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <ViewAttribute
    Name="FreeBalance"
    IsSelected="false"
    IsPersistent="false"
    PrecisionRule="true"
    Type="java.math.BigDecimal"
    ColumnType="NUMBER"
    AliasName="VIEW_ATTR"
    SQLType="NUMERIC">
    <RecalcCondition><![CDATA[true]]></RecalcCondition>
    <TransientExpression><![CDATA[((SaleQty<0||SaleQty==null) ? 0:SaleQty)]]></TransientExpression>
    <Dependencies>
      <Item
        Value="SaleQty"/>
    </Dependencies>
    <Properties>
      <SchemaBasedProperties>
        <LABEL
          ResId="FreeBalance_LABEL"/>
      </SchemaBasedProperties>
    </Properties>
  </ViewAttribute>
  <AttrArray Name="KeyAttributes">
    <Item Value="InvestorCode"/>
    <Item Value="ShortName"/>
  </AttrArray>
  <ResourceBundle>
    <PropertiesBundle
      PropertiesFile="leads.capita.trade.TradeModelBundle"/>
  </ResourceBundle>
</ViewObject>
